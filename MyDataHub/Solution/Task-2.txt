
--Допущения:

--Неделю с 26.09 по 02.10 я включил в данные целиком, хотя задание можно понять по-разному.


SELECT DISTINCT user_id
FROM  (SELECT   user_id , 
				extract (week from date) week,
				COUNT(DISTINCT id) orders,
				COUNT(*) OVER(PARTITION BY user_id) week_count
		FROM  orders o 
		WHERE extract (week from date) >= 39 --26.09 - 02.10 
		GROUP BY user_id , week
		HAVING COUNT(DISTINCT id) >= 5) c
WHERE week_count  = 5;


--Результат:

2695
14255
19318
26074
28738
64192
74302
96750
104967
124724
139594
142892
155423
164613
166048
174623
177576
180423
188312
193981
206216
207354
210024
216893
219960
232120
240411
248551
263931
266160
274949
279277
283563
284066
288119
290749
294125
298290
302697
303670
304941
306114
306203
308471
312589
312766
315760
316622
318446
319435
331892
336844
337368
338789
342739
343795
348529
350613
352402
352485
353281
357101
359721
360118
362765
363601
366793
369106
369438
373071
375375
376094
377677
377873
378365
379105
379455
379618
380363
381558
381938
382927
383356
383803
383883
384442
387408
387787
387861
388782
389025
390596
391702
392003
392673
395349
395586
399887
403298
403583
404073
406106
406569
408310
408492
408575
410391
410650
411806
412101
412295
412835
414837
415385
416510
417818
420265
420364
421151
422740
423296
427311
428317
428380
429023
431265
431671
434217
435384
435932
435996
436457
436880
440242
441631
442919
443199
444577
444618
445701
447082
447213
447934
448082
448221
448562
449378
450482
451305
451908
452853
455293
455816
455927
457050
458435
458554
460209
461778
462470
463358
463412
464003
466021
466142
466166
466488
466563
467044
467672
467929
468311
468355
468692
468720
469868
470632
470704
471931
475605
476506
477073
478343
479929
480360
482193
482710
484618
484624
486196
486663
487373
487534
488137
488463
489022
489540
490087
490225
490286
490850
491079
491219
492235
492584
494274
495076
496248
496351
496442
496684
497559
498281
499675
499958
500044
500546
500819
501512
502968
504070
504793
504943
506219
506770
